{% extends 'WebProfilerBundle:Profiler:layout.html.twig' %}

{% block toolbar %}

    {# <link rel="stylesheet" href="http://code.jquery.com/ui/1.9.1/themes/base/jquery-ui.css" /> #}
    <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.9.0/themes/redmond/jquery-ui.css" />
    <link rel="stylesheet" href="http://ajax.aspnetcdn.com/ajax/jquery.dataTables/1.9.4/css/jquery.dataTables.css" />
    <link rel="stylesheet" href="http://ajax.aspnetcdn.com/ajax/jquery.dataTables/1.9.4/css/jquery.dataTables_themeroller.css" />

    
    <script src="http://code.jquery.com/jquery-1.8.3.js"></script>
    <script src="http://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>
    <script src="http://ajax.aspnetcdn.com/ajax/jquery.dataTables/1.9.4/jquery.dataTables.min.js"></script>
       
    {% if collector.counterrors %}
        {% set icon %}
            <img width="15" height="28" alt="Logs" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAcCAYAAABoMT8aAAAA4klEQVQ4y2P4//8/AyWYYXgYwOPp6Xnc3t7+P7EYpB6k7+zZs2ADNEjRjIwDAgKWgAywIUfz8+fPVzg7O/8AGeCATQEQnAfi/SAah/wcV1dXvAYUgORANA75ehcXl+/4DHAABRIe+ZrhbgAhTHsDiEgHBA0glA6GfSDiw5mZma+A+sphBlhVVFQ88vHx+Xfu3Ll7QP5haOjjwtuAuGHv3r3NIMNABqh8+/atsaur666vr+9XUlwSHx//AGQANxCbAnEWyGQicRMQ9wBxIQM0qjiBWAFqkB00/glhayBWHwb1AgB38EJsUtxtWwAAAABJRU5ErkJggg=="/>
            <span class="sf-toolbar-status sf-toolbar-status-yellow">{{ collector.counterrors }}</span>
        {% endset %}
        {% set text %}
            <div class="sf-toolbar-info-piece">
                <b>Exception</b>
                <span class="sf-toolbar-status sf-toolbar-status-yellow">{{ collector.counterrors }}</span>
            </div>
        {% endset %}
        {% include 'WebProfilerBundle:Profiler:toolbar_item.html.twig' with { 'link': profiler_url } %}
    {% endif %}
{% endblock %}

{% block menu %}
<span class="label">
    <span class="icon"><img src="{{ asset('bundles/app/images/ico/32/terminal.png') }}" alt="Logger" /></span>
    <strong>Logs</strong>
    {% if collector.counterrors %}
        <span class="count">
            <span>{{ collector.counterrors }}</span>
        </span>
    {% endif %}
</span>
{% endblock %}

{% block panel %}
    <h2>Logs</h2>

    {% set priority = app.request.query.get('priority', 0) %}
    
    {% set logName={ 0: 'All...', 100: 'DEBUG',    200: 'INFO', 250:    'NOTICE', 300: 'WARNING', 400: 'ERROR', 500: 'CRITICAL', 550: 'ALERT', 600: 'EMERGENCY' } %}
    {% set icoLog={ 0: 'log_all.png', 100: 'log_debug.png', 200: 'log_infos.png', 250: 'log_notice.png', 300: 'log_exclamation-orange.png', 400: 'log_exclamation-red.png', 500: 'log_warning2.png', 550: 'log_warning.png', 600: 'log_alert.png' } %}
    
    <table><caption><h1>VERSION AMU app/Resources v2.1 </h1></caption>
        <tr>
            <th>Filter</th>
            <td>
                <form id="priority-form" action="" method="get" style="display: inline">
                    <input type="hidden" name="panel" value="logger" />
                    <label for="priority">Priority </label>
                    <select id="priority" name="priority" onchange="document.getElementById('priority-form').submit(); ">
                      {# disabled 201: '=> AMU', 202: '=> CAS', 203: '=> LDAP', 204: '=> GROUPER', 205: '=> APOGEE', 205: '=> PDF',206: '=> AJAX',
                        {{ (text|slice(0,2)=="=>")?" style='color:green;' ":"" }}
                      #}
                        {% for value, text in logName %}
                        <option value="{{ value }}"{{ value == priority ? ' selected' : '' }} >{{ text }}</option>
                        {% endfor %}
                      </select>
                          {% for value, text in logName %}
                            &nbsp;<img class="ui-widget-content ui-corner-all ui-button" src="{{ asset('bundles/app/images/log/'~icoLog[value]) }}" align="absmiddle" style="padding:2px;{{ (value==priority)?"border: blue solid 2px;":"" }}" title="{{ value }} => {{ text}}" onclick="document.getElementById('priority').value={{ value }};document.getElementById('priority-form').submit();" />
                          {%endfor%}
          
                    <noscript>
                        <input type="submit" value="refresh" />
                    </noscript>
                </form>
            </td>
        </tr>
    </table>

    {% if collector.logs %}
    
        
            <table class="datatable">
              <thead><th>Date</th><th>Time</th>{#<th>Priority</th>#}<th>Type</th><th>Message</th>{#<th>Context</th>#}</thead>
              <tbody>
            {% for log in collector.logs if log.priority >= priority %}
              <tr class="{{ cycle(['odd', 'even'], loop.index) }}{% if log.priority >= 400 %} error{% elseif log.priority >= 300 %} warning{% endif %}">
                  <td>{{ log.timestamp|date("d/m/Y") }} </td>
                  <td>{{ log.timestamp|date("H:i:s") }}</td>
                  {#<td>{{ log.priority }}</td>#}
                  <td style="text-align:center;"><span style="display:none;">{{ log.priority }}</span><img class="ui-corner-all" src="{{ asset('bundles/app/images/log/'~icoLog[log.priority]) }}" align="absmiddle" style="padding:2px;" title="{{ log.priority }} => {{ log.priorityName }}" /></td>
                  {#<td>{{ log.message|raw  }}</td>#}
                  <td>{%if (log.message|length > 255) and ("accordion_debug" not in log.message|slice(0,255)) %}<div class='accordion_debug' ><h3>{{log.message|slice(0,100)|raw }}...</h3><div>{{ log.message|raw  }}</div></div>{%else%}{{ log.message|raw  }}{%endif%}</td>
                  {#<td>{% if log.context is defined and log.context is not empty %} {{ log.context|yaml_encode  }} {% endif %}</td>#}
            {% endfor %}
                  </tr>    
              </tbody>
              </table>
    {% else %}
      <div class='accordion_debug' >  
        <h3><em>No logs available for this priority.</em></h3>
        <div>&nbsp;</div>
      </div>
    {% endif %}
        
    <script type="text/javascript">
        $( ".accordion_debug" ).accordion({
        collapsible:true,
        active:false
      });
      
      try {
      $('.datatable').dataTable({
        "bDestroy": true,
        "bJQueryUI": true,
        "iDisplayLength": 100,
        "sPaginationType": "full_numbers"
      });
    } catch(ex){} 
    
    
    $(".fg-toolbar").css('font-size',"12px");
    //$(".accordion_debug > *").css('font-size',"10px");
    
     </script>
                      
{% endblock %}

                           